<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>現金收入分配器</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for Inter, if not already handled by Tailwind defaults or system */
        html {
            font-family: 'Inter', sans-serif;
        }
        /* Basic styling adjustments for better aesthetics */
        body {
            background-color: #f3f4f6; /* Light gray background */
        }
        .container {
            max-width: 90%; /* Responsive width */
            margin: auto;
            padding: 1rem; /* Padding for mobile */
        }
        @media (min-width: 640px) { /* Small screens and up */
            .container {
                max-width: 600px; /* Max width for desktop */
                padding: 2rem; /* More padding on larger screens */
            }
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="container bg-white p-6 md:p-8 rounded-lg shadow-xl border border-gray-200">
        <h1 class="text-3xl md:text-4xl font-bold text-center mb-6 text-gray-800">現金收入分配器</h1>

        <div class="space-y-4">
            <!-- Cash Income Input -->
            <div>
                <label for="cashIncome" class="block text-lg font-medium text-gray-700 mb-2">現金收入 (TWD)</label>
                <input type="number" id="cashIncome" placeholder="輸入您的總收入"
                       class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 text-lg">
            </div>

            <!-- Percentage Inputs -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                    <label for="debtPercent" class="block text-base font-medium text-gray-700 mb-2">還債 (%)</label>
                    <input type="number" id="debtPercent" value="40" min="0" max="100"
                           class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 text-lg">
                </div>
                <div>
                    <label for="savingsPercent" class="block text-base font-medium text-gray-700 mb-2">儲蓄 (%)</label>
                    <input type="number" id="savingsPercent" value="30" min="0" max="100"
                           class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 text-lg">
                </div>
                <div>
                    <label for="disposablePercent" class="block text-base font-medium text-gray-700 mb-2">可用 (%)</label>
                    <input type="number" id="disposablePercent" value="30" min="0" max="100"
                           class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 text-lg">
                </div>
                <!-- New Input Field: Other Expenses -->
                <div>
                    <label for="otherExpensesPercent" class="block text-base font-medium text-gray-700 mb-2">其他費用 (%)</label>
                    <input type="number" id="otherExpensesPercent" value="0" min="0" max="100"
                           class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-gray-900 text-lg">
                </div>
            </div>

            <!-- Calculate Button -->
            <button id="calculateBtn"
                    class="w-full mt-6 py-3 px-6 border border-transparent rounded-md shadow-sm text-lg font-semibold text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                計算分配
            </button>
        </div>

        <!-- Results Display -->
        <div class="mt-8 pt-6 border-t border-gray-200 space-y-4">
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">分配結果</h2>

            <div class="bg-gray-50 p-4 rounded-md shadow-sm">
                <p class="text-base text-gray-600 font-medium flex justify-between items-center">
                    總百分比: <span id="totalPercentage" class="text-indigo-600 text-lg font-semibold">100%</span>
                </p>
                <p class="text-sm text-gray-500 flex justify-between items-center mt-1">
                    差異: <span id="percentageDifference" class="text-red-500 text-base font-medium">0% (完美分配)</span>
                </p>
            </div>

            <div class="bg-indigo-50 p-4 rounded-md shadow-sm">
                <p class="text-lg font-medium text-gray-700 flex justify-between items-center">
                    還債金額: <span id="debtAmount" class="text-indigo-700 text-xl font-bold">0 TWD</span>
                </p>
            </div>
            <div class="bg-green-50 p-4 rounded-md shadow-sm">
                <p class="text-lg font-medium text-gray-700 flex justify-between items-center">
                    儲蓄金額: <span id="savingsAmount" class="text-green-700 text-xl font-bold">0 TWD</span>
                </p>
            </div>
            <div class="bg-yellow-50 p-4 rounded-md shadow-sm">
                <p class="text-lg font-medium text-gray-700 flex justify-between items-center">
                    可用金額: <span id="disposableAmount" class="text-yellow-700 text-xl font-bold">0 TWD</span>
                </p>
            </div>
            <!-- New Output Field: Other Expenses Amount -->
            <div class="bg-blue-50 p-4 rounded-md shadow-sm">
                <p class="text-lg font-medium text-gray-700 flex justify-between items-center">
                    其他費用金額: <span id="otherExpensesAmount" class="text-blue-700 text-xl font-bold">0 TWD</span>
                </p>
            </div>

            <!-- Error/Message Box -->
            <div id="messageBox" class="hidden mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md" role="alert">
                <p id="messageText" class="text-sm"></p>
            </div>
        </div>
    </div>

    <script>
        // Get references to input elements
        const cashIncomeInput = document.getElementById('cashIncome');
        const debtPercentInput = document.getElementById('debtPercent');
        const savingsPercentInput = document.getElementById('savingsPercent');
        const disposablePercentInput = document.getElementById('disposablePercent');
        const otherExpensesPercentInput = document.getElementById('otherExpensesPercent'); // New: Other Expenses input
        const calculateBtn = document.getElementById('calculateBtn');

        // Get references to output elements
        const totalPercentageSpan = document.getElementById('totalPercentage');
        const percentageDifferenceSpan = document.getElementById('percentageDifference');
        const debtAmountSpan = document.getElementById('debtAmount');
        const savingsAmountSpan = document.getElementById('savingsAmount');
        const disposableAmountSpan = document.getElementById('disposableAmount');
        const otherExpensesAmountSpan = document.getElementById('otherExpensesAmount'); // New: Other Expenses amount span
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');

        // Function to display messages
        function showMessage(message, type = 'error') {
            messageText.textContent = message;
            messageBox.classList.remove('hidden', 'bg-red-100', 'border-red-400', 'text-red-700', 'bg-green-100', 'border-green-400', 'text-green-700');
            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
            } else if (type === 'warning') { // New: Warning type for messages
                messageBox.classList.add('bg-yellow-100', 'border-yellow-400', 'text-yellow-700');
            }
            messageBox.classList.remove('hidden'); // Ensure message box is visible
        }


        // Function to hide messages
        function hideMessage() {
            messageBox.classList.add('hidden');
            messageText.textContent = '';
        }

        // Function to update the total percentage and difference display
        function updatePercentageSummary() {
            const debtP = parseFloat(debtPercentInput.value) || 0;
            const savingsP = parseFloat(savingsPercentInput.value) || 0;
            const disposableP = parseFloat(disposablePercentInput.value) || 0;
            const otherExpensesP = parseFloat(otherExpensesPercentInput.value) || 0; // New: Get other expenses percentage
            const totalP = debtP + savingsP + disposableP + otherExpensesP; // New: Add other expenses to total
            const difference = totalP - 100;

            totalPercentageSpan.textContent = `${totalP.toFixed(0)}%`; // Format to whole number for display

            if (totalP === 100) {
                percentageDifferenceSpan.textContent = `0% (完美分配)`;
                percentageDifferenceSpan.classList.remove('text-red-500', 'text-orange-500');
                percentageDifferenceSpan.classList.add('text-green-600');
            } else if (totalP < 100) {
                percentageDifferenceSpan.textContent = `剩餘 ${Math.abs(difference).toFixed(0)}% (未分配)`;
                percentageDifferenceSpan.classList.remove('text-green-600', 'text-red-500');
                percentageDifferenceSpan.classList.add('text-orange-500');
            } else {
                percentageDifferenceSpan.textContent = `超出 ${Math.abs(difference).toFixed(0)}% (過度分配)`;
                percentageDifferenceSpan.classList.remove('text-green-600', 'text-orange-500');
                percentageDifferenceSpan.classList.add('text-red-500');
            }
        }

        // Event listener for input changes to update percentage summary in real-time
        debtPercentInput.addEventListener('input', updatePercentageSummary);
        savingsPercentInput.addEventListener('input', updatePercentageSummary);
        disposablePercentInput.addEventListener('input', updatePercentageSummary);
        otherExpensesPercentInput.addEventListener('input', updatePercentageSummary); // New: Listen for other expenses input

        // Initial update of percentage summary on load
        updatePercentageSummary();


        // Event listener for the calculate button
        calculateBtn.addEventListener('click', () => {
            hideMessage(); // Hide any previous messages

            const cashIncome = parseFloat(cashIncomeInput.value);
            const debtPercent = parseFloat(debtPercentInput.value);
            const savingsPercent = parseFloat(savingsPercentInput.value);
            const disposablePercent = parseFloat(disposablePercentInput.value);
            const otherExpensesPercent = parseFloat(otherExpensesPercentInput.value); // New: Get other expenses percentage

            // Input validation
            if (isNaN(cashIncome) || cashIncome < 0) {
                showMessage('請輸入有效的現金收入金額。');
                return;
            }

            if (isNaN(debtPercent) || debtPercent < 0 || isNaN(savingsPercent) || savingsPercent < 0 || isNaN(disposablePercent) || disposablePercent < 0 || isNaN(otherExpensesPercent) || otherExpensesPercent < 0) {
                showMessage('請輸入有效的百分比 (0-100)。');
                return;
            }

            // Calculate total percentage
            const totalPercentage = debtPercent + savingsPercent + disposablePercent + otherExpensesPercent; // New: Add other expenses to total

            // Check if percentages sum to 0 or negative
            if (totalPercentage <= 0) {
                showMessage('總百分比不能為零或負數。請調整分配。');
                return;
            }


            // Calculate amounts
            const debtAmount = (cashIncome * debtPercent) / 100;
            const savingsAmount = (cashIncome * savingsPercent) / 100;
            const disposableAmount = (cashIncome * disposablePercent) / 100;
            const otherExpensesAmount = (cashIncome * otherExpensesPercent) / 100; // New: Calculate other expenses amount

            // Update display
            debtAmountSpan.textContent = `${debtAmount.toFixed(2)} TWD`;
            savingsAmountSpan.textContent = `${savingsAmount.toFixed(2)} TWD`;
            disposableAmountSpan.textContent = `${disposableAmount.toFixed(2)} TWD`;
            otherExpensesAmountSpan.textContent = `${otherExpensesAmount.toFixed(2)} TWD`; // New: Display other expenses amount


            // Update percentage summary again after calculation (redundant but ensures consistency)
            updatePercentageSummary();

            if (totalPercentage !== 100) {
                showMessage(`注意：您的百分比總和為 ${totalPercentage.toFixed(0)}%，與 100% 不符。金額將按您輸入的百分比分配。`, 'warning');
            } else {
                // If it sums to 100, we can optionally show a success message or just hide messages.
                hideMessage();
            }
        });
    </script>
</body>
</html>
